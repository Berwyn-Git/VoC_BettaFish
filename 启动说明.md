# Flask 应用启动和重启指南

## 📋 启动方法

### 方法一：使用启动脚本（推荐）

#### Windows 系统

1. **普通启动**（生产环境推荐）
   ```bash
   start_app.bat
   ```
   - 自动清理端口占用
   - 启动 Flask 应用
   - 适合生产环境使用

2. **自动重载启动**（开发环境推荐）
   ```bash
   start_app_auto_reload.bat
   ```
   - 启用 Flask 的 debug 模式
   - 代码更改时自动重启
   - 适合开发环境使用

3. **重启应用**
   ```bash
   restart_app.bat
   ```
   - 先停止所有相关进程
   - 然后重新启动应用

#### Linux/Mac 系统

```bash
# 添加执行权限（首次使用）
chmod +x start_app.sh

# 启动应用
./start_app.sh
```

### 方法二：直接使用 Python

#### 普通启动
```bash
python app.py
```

#### 启用自动重载（开发环境）
```bash
# 方式1: 使用环境变量
set FLASK_DEBUG=true
set FLASK_RELOAD=true
python app.py

# 方式2: 使用命令行参数
python app.py --debug --reload
```

### 方法三：使用 Flask CLI

```bash
# 设置环境变量
export FLASK_APP=app.py
export FLASK_DEBUG=1

# 启动应用
flask run
```

## 🔄 自动重启功能

### 开发环境自动重启

Flask 应用支持两种自动重启方式：

1. **Debug 模式自动重载**
   - 使用 `start_app_auto_reload.bat` 或设置 `FLASK_DEBUG=true`
   - 代码更改时自动重启
   - 显示详细的错误信息

2. **使用 watchdog 监控文件变化**（可选）
   ```bash
   pip install watchdog
   python -m watchdog.observers
   ```

### 生产环境

生产环境**不建议**使用自动重载，因为：
- 性能开销较大
- 可能影响稳定性
- 建议使用进程管理器（如 supervisor、pm2）

## 🛠️ 手动重启步骤

如果需要手动重启：

1. **停止 Flask 应用**
   - 在运行 Flask 的终端按 `Ctrl+C`
   - 或使用任务管理器结束 Python 进程

2. **清理端口占用**
   ```bash
   # Windows
   netstat -ano | findstr ":5000"
   taskkill /F /PID <进程ID>
   
   # Linux/Mac
   lsof -ti :5000 | xargs kill -9
   ```

3. **重新启动**
   ```bash
   python app.py
   # 或使用启动脚本
   start_app.bat  # Windows
   ./start_app.sh  # Linux/Mac
   ```

## 📝 注意事项

1. **端口占用**
   - Flask 默认使用端口 5000
   - Streamlit 应用使用端口 8501、8502、8503
   - 启动脚本会自动清理这些端口的占用

2. **编码问题**
   - 启动脚本已设置 UTF-8 编码
   - 如果遇到编码问题，检查系统环境变量

3. **环境变量**
   - 确保已激活正确的 Python 环境（conda/venv）
   - 确保已安装所有依赖：`pip install -r requirements.txt`

4. **日志文件**
   - 应用日志保存在 `logs/` 目录
   - Streamlit 应用日志也在 `logs/` 目录

## 🚀 快速开始

最简单的启动方式：

```bash
# Windows
start_app.bat

# Linux/Mac
./start_app.sh
```

然后访问：http://localhost:5000

## ❓ 常见问题

**Q: 端口被占用怎么办？**
A: 启动脚本会自动清理端口占用。如果仍有问题，手动执行清理命令。

**Q: 如何查看应用是否正在运行？**
A: 访问 http://localhost:5000，或检查端口占用：
```bash
# Windows
netstat -ano | findstr ":5000"

# Linux/Mac
lsof -i :5000
```

**Q: 代码更改后没有自动重启？**
A: 确保使用 `start_app_auto_reload.bat` 或设置了 `FLASK_DEBUG=true`

**Q: 如何完全停止应用？**
A: 在运行应用的终端按 `Ctrl+C`，或使用 `restart_app.bat`（Windows）

